{% extends 'base.html' %}

{% block title %}Chat Support - My Web Page{% endblock %}

{% block header %}
<header class="masthead" style="background-image: url('{{ url_for('static', filename='assets/img/contact-bg.jpg') }}')">
    <div class="container position-relative px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-md-10 col-lg-8 col-xl-7">
                <div class="page-heading">
                    <h1>Chat Support</h1>
                    <span class="subheading">Get instant help from our AI assistant</span>
                </div>
            </div>
        </div>
    </div>
</header>
{% endblock %}

{% block content %}
    <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-md-10 col-lg-8 col-xl-7">
            <!-- Chat Container -->
            <div id="chatContainer" class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-robot me-2"></i>
                        AI Customer Support
                        <span id="chatStatus" class="badge bg-success ms-2">Online</span>
                    </h5>
                </div>
                
                <div class="card-body p-0">
                    <!-- Chat Messages -->
                    <div id="chatMessages" class="chat-messages" style="height: 400px; overflow-y: auto; padding: 15px;">
                        <div class="text-center text-muted">
                            <i class="fas fa-spinner fa-spin"></i>
                            Starting chat session...
                        </div>
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div id="typingIndicator" class="typing-indicator" style="display: none;">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <small class="text-muted ms-2">AI is typing...</small>
                    </div>
                </div>
                
                <div class="card-footer">
                    <!-- Message Input -->
                    <div class="input-group">
                        <input type="text" id="messageInput" class="form-control" 
                               placeholder="Type your message..." 
                               maxlength="500">
                        <button id="sendButton" class="btn btn-primary" type="button">
                            <i class="fas fa-paper-plane"></i>
                            Send
                        </button>
                    </div>
                    <small class="text-muted mt-1">
                        Press Enter to send â€¢ Powered by AI
                    </small>
                </div>
            </div>
            
            <!-- Chat Actions -->
            <div class="text-center mt-3">
                <button id="clearChatBtn" class="btn btn-outline-secondary me-2">
                    <i class="fas fa-trash"></i> Clear Chat
                </button>
                <button id="endChatBtn" class="btn btn-outline-danger">
                    <i class="fas fa-times"></i> End Chat
                </button>
            </div>
            
            <!-- Alternative Contact -->
            <div class="mt-4 text-center">
                <p class="text-muted">
                    Need more help? 
                    <a href="{{ url_for('chatbot.about') }}" class="text-decoration-none">
                        Contact our support team
                    </a>
                </p>
            </div>
        </div>
    </div>

    <!-- Chat JavaScript -->
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}

{% block extra_css %}
<style>
.chat-messages {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
}

.message {
    margin-bottom: 15px;
    display: flex;
}

.message.user {
    justify-content: flex-end;
}

.message.bot {
    justify-content: flex-start;
}

.message-content {
    max-width: 70%;
    padding: 10px 15px;
    border-radius: 20px;
    word-wrap: break-word;
}

.message.user .message-content {
    background-color: #0085A1;
    color: white;
    border-bottom-right-radius: 5px;
}

.message.bot .message-content {
    background-color: white;
    color: #333;
    border: 1px solid #dee2e6;
    border-bottom-left-radius: 5px;
}

.message-time {
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 5px;
}

.typing-indicator {
    padding: 10px 15px;
    display: flex;
    align-items: center;
}

.typing-dots {
    display: flex;
    gap: 3px;
}

.typing-dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #6c757d;
    animation: typing 1.4s infinite ease-in-out;
}

.typing-dots span:nth-child(1) { animation-delay: -0.32s; }
.typing-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
    40% { transform: scale(1); opacity: 1; }
}

.chat-container-minimized {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    z-index: 1000;
}
</style>
{% endblock %}